<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- For Mobile Devices -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<title>Boost.SIMD: tutorial_sum</title>
<!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link rel="icon" href="numscale_icon.png">
<link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="doxy-boot.js"></script>
</head>
<body>
<nav class="navbar navbar-default" role="navigation">
<div class="container">
<div class="navbar-header responsive-logo">
<a class="navbar-brand" style="width: 10%" href="https://github.com/NumScale/boost.simd">Boost.SIMD </a>
<a href="http://numscale.implicitweb.fr/" title="Numscale" style="display: block; width: 25%; text-align: right; float: right"><img src="numscale.png" alt="Numscale" style="width:100%; padding-top: 10px; padding-bottom: 10px; " align="right"></a>
</div>
</div>
</nav>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div class="content" id="content">
<div class="container">
<div class="row">
<div class="col-sm-12 panel " style="padding-bottom: 35px;">
<div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="_quick_start.html"><span>Quick&#160;Start</span></a></li>
      <li><a href="tutorials.html"><span>Tutorials</span></a></li>
      <li><a href="modules.html"><span>Reference&#160;documentation</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">tutorial_sum </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="topofpage_sum"></a></p>
<h1><a class="anchor" id="tutorial-sum"></a>
Sum of Arrays</h1>
<ul>
<li><a class="el" href="md__c_1__users__joel__documents_dev_open_source_boost_libs_simd_doc_tutorial_hello.html#tutorial-hello">SIMD HelloWorld</a></li>
<li><a class="el" href="md__c_1__users__joel__documents_dev_open_source_boost_libs_simd_doc_tutorial_sum.html#tutorial-sum">Sum of Arrays</a></li>
<li><a class="el" href="tutorial-reduction.html">Reductions</a></li>
<li><a class="el" href="tutorial-data.html">Processing Data the SIMD Way</a></li>
<li><a class="el" href="tutorial-runtime.html">Runtime Extension Selection</a></li>
</ul>
<p>In this tutorial we will demonstrate different ways to load and use a <a class="el" href="classboost_1_1simd_1_1pack.html" title="High-level interface for manipulating SIMD data. ">boost::simd::pack</a> in a more realistic uses cases than in the previous tutorial by vectorizing the following scalar code:</p>
<div class="fragment"><div class="line">  <span class="comment">// Scalar version</span></div>
<div class="line">  <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> i = 0 ; i &lt; size ; ++i ){</div>
<div class="line">    out[i] = array[i] - scalar;</div>
<div class="line">  }</div>
</div><!-- fragment --><p> We will use <a class="el" href="namespaceboost_1_1simd_a44f9b5b1a343b238a3a80a52365ec860.html#a44f9b5b1a343b238a3a80a52365ec860" title="Load a value from memory into a generic variable. ">boost::simd::load</a> and <a class="el" href="namespaceboost_1_1simd_af50789733f52bd58296f90d91b5b3b3e.html#af50789733f52bd58296f90d91b5b3b3e" title="Store a value at an arbitrary memory location. ">boost::simd::store</a> functions to load data into a pack and store it back into memory. These functions are accessed by including the following headers:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;boost/simd/function/load.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;boost/simd/function/store.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;boost/simd/function/minus.hpp&gt;</span></div>
</div><!-- fragment --><p> We shall first assume that the size of our array is a multiple of the cardinal (number of elements in a pack) for our target machine. Please note that this assumption is very unsafe as code written using <b>Boost.SIMD</b> is designed to be portable across multiple architectures! The more realistic case where this is no longer true is demonstrated afterwards. It is generally easiest and safest to use the default pack size, corresponding to the size of the available physical <em>SIMD</em> registers. This size may be obtained using the <a class="el" href="structboost_1_1simd_1_1cardinal__of.html" title="Computes the register width required to store an instance of any type T. ">boost::simd::cardinal_of</a> function.</p>
<div class="fragment"><div class="line">  <span class="keywordtype">size_t</span> ipack_card = <a class="code" href="structboost_1_1simd_1_1cardinal__of.html">bs::cardinal_of&lt;ipack_t&gt;</a>();</div>
</div><!-- fragment --><p> The first step in vectorizing this code is to load the data in a <b>SIMD</b> vector. Several diferent ways of doing this were demonstrated in the previous tutorial. We shall construct our pack with a pointer to the data we wish to load. We then perform the subtraction using the operator <code>-</code> and then store the data using <code><a class="el" href="namespaceboost_1_1simd_af50789733f52bd58296f90d91b5b3b3e.html#af50789733f52bd58296f90d91b5b3b3e" title="Store a value at an arbitrary memory location. ">boost::simd::store</a></code></p>
<div class="fragment"><div class="line">  <span class="comment">// Using pointer construction</span></div>
<div class="line">  ipack_t one28{scalar};</div>
<div class="line">  <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> i = 0 ; i &lt; size ; i += ipack_card ) {</div>
<div class="line">    ipack_t p_arr(array.data() + i);</div>
<div class="line">    p_out = p_arr - one28;</div>
<div class="line">    <a class="code" href="namespaceboost_1_1simd_af5521b79da254d7133fa74cfaf547e10.html#af5521b79da254d7133fa74cfaf547e10">bs::store</a>(p_out , out.data() + i);</div>
<div class="line">  }</div>
</div><!-- fragment --><p> Note that our loop is incremented by the number of elements in our pack as we are processing <code>ipack_card</code> elements per loop iteration! Also note that <code>one28</code> is declared outside of the loop so that it is not loaded at each iteration. Generally speaking, any compiler which supports <b>Boost.SIMD</b> would automatically optimize this, although it is better to be safe!</p>
<p>If we wish to declare our pack outside of the loop, for example, if we wish to re-use it later, we can load the data using <code><a class="el" href="namespaceboost_1_1simd_a44f9b5b1a343b238a3a80a52365ec860.html#a44f9b5b1a343b238a3a80a52365ec860" title="Load a value from memory into a generic variable. ">boost::simd::load</a></code>:</p>
<div class="fragment"><div class="line">  <span class="comment">// Using explicit load/store</span></div>
<div class="line">  ipack_t p_out;</div>
<div class="line">  ipack_t p_arr;</div>
<div class="line">  ipack_t one28{scalar};</div>
<div class="line">  <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> i = 0 ; i &lt; size ; i += ipack_card ) {</div>
<div class="line">    p_arr = bs::load&lt;ipack_t&gt;(array.data() + i);</div>
<div class="line">    p_out = p_arr - one28;</div>
<div class="line">    <a class="code" href="namespaceboost_1_1simd_af5521b79da254d7133fa74cfaf547e10.html#af5521b79da254d7133fa74cfaf547e10">bs::store</a>(p_out , out.data() + i);</div>
<div class="line">  }</div>
</div><!-- fragment --><p> Easy, isn't it? Vectorization of code isn't using <b>Boost.SIMD</b> isn't so bad!</p>
<p>Now, let's extend the previous example to deal with the case where the size of our vector isn't a multiple of our machine's phyiscal register size.</p>
<div class="fragment"><div class="line">  <span class="comment">// Using explicit load/store</span></div>
<div class="line">  <span class="comment">//set size to an arbitrary value</span></div>
<div class="line">  size = 133;</div>
<div class="line">  ipack_t p_out;</div>
<div class="line">  ipack_t p_arr;</div>
<div class="line">  ipack_t one28{scalar};</div>
<div class="line">  <span class="keywordtype">size_t</span> i = 0;</div>
<div class="line">  <span class="keywordflow">for</span> (; i + ipack_card &lt;= size ; i += ipack_card ) {</div>
<div class="line">    p_arr = bs::load&lt;ipack_t&gt;(array.data() + i);</div>
<div class="line">    p_out = p_arr - one28;</div>
<div class="line">    <a class="code" href="namespaceboost_1_1simd_af5521b79da254d7133fa74cfaf547e10.html#af5521b79da254d7133fa74cfaf547e10">bs::store</a>(p_out , out.data() + i);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span> (; i &lt; size ; ++i){</div>
<div class="line">    out[i] = array[i] - scalar;</div>
<div class="line">  }</div>
</div><!-- fragment --><p> There are three main differences between this loop and the previous one. Firstly, the loop counter <code>i</code> is declared outside of the first loop. This is so that its value is retained for use in the second loop. The second difference is in seen in the first loops termination condition. The loop is now terminated when <code>i + ipack_card &lt;= size</code>. We do this to ensure that we never load data which is past the end of the array. The third and final difference is the second loop. This is almost identical to the scalar loop at the start of this tutorial. The remaining elements in the input array, which are not sufficient to fill a <b>SIMD</b> vector are processed individually. A more elegant way of achieving this is demonstrated in the tutorial <a class="el" href="md__c_1__users__joel__documents_dev_open_source_boost_libs_simd_doc_tutorial_algorithm.html#tutorial-algorithm">Algorithm</a> . </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated on Thu Aug 18 2016 16:43:12 for Boost.SIMD by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
